---
title: 5.0.0
nav_order: 163
parent: iOS SDK
---

## 5.0.0 version<a id='5.0.0'></a>

## Table of Contents
* [What's New](#5.0.0-what-is-new)
* [Installation](#5.0.0-installation)
* [Initialization and display](#5.0.0-usage)
* [Preparation for later use](#5.0.0-later-use)
	* [Download](#5.0.0-download)
	* [Preload](#5.0.0-preload)
* [Management](#5.0.0-management)
	* [Plan information](#5.0.0-info)
	* [Settings](#5.0.0-settings)
	* [Commands](#5.0.0-commands)
	* [Requests](#5.0.0-requests)
* [Events](#5.0.0-events)
* [Navigation](#5.0.0-navigation)
	* [Location provider management](#5.0.0-navigation-management)
	* [Global location provider](#5.0.0-navigation-global)
	* [Third-party location providers](#5.0.0-third-party-navigation)
	* [CrowdConnected location provider](#5.0.0-cc-navigation)
	* [IndoorAtlas location provider](#5.0.0-ia-navigation)

## What's New in ExpoFP SDK version 5.0.0<a id='5.0.0-what-is-new'></a>

* The SDK architecture has been completely redesigned, now the `presenter` is responsible for managing the plan, and the display layer is passive, reusable and lightweight;
* Implemented support for async/await;
* You can download an unlimited number of plans for offline use;
* You can preload downloaded plans and plans from the internet for later use, no limits;
* Improved stability and loading speed;
* Location provider wrappers are now open source;

## Installation<a id='5.0.0-installation'></a>
### SPM

```swift
dependencies: [
    .package(url: "https://github.com/expofp/expofp-sdk-ios", from: "5.0.0"),
]
```

and then as a dependency for the Package target utilizing **ExpoFP**:

```swift
.target(
    name: "MyApp",
    dependencies: [
        .product(name: "ExpoFP", package: "expofp-sdk-ios"),
    ]
),
```

### CocoaPods [will be deprecated soon](https://blog.cocoapods.org/CocoaPods-Specs-Repo/)

```
spec.dependency 'ExpoFP', '~>5.0.0'
```

## Initialization and display<a id='5.0.0-usage'></a>

`ExpoFpPlan` is a global entry point to create, download or preload a plan and to [setup global location provider](#5.0.0-navigation).

### Initialize a plan `presenter`

```swift
let expoKey = "YourExpoKey"
let presenter = ExpoFpPlan.createPlanPresenter(with: .expoKey(expoKey))
```

or with additional parameters

```swift
let expoKey = "YourExpoKey"
let additionalParams = [URLQueryItem(name: "noOverlay", value: "true")]
let locationProvider: IExpoFpLocationProvider = YourLocationProvider() // or Golbal location provider
let messageListener: IExpoFpPlanMessageListener = YourMessageListener()

let presenter = ExpoFpPlan.createPlanPresenter(
    with: .expoKey(expoKey),
    additionalParams: additionalParams,
    locationProvider: locationProvider,
    messageListener: messageListener
)
```

### Present in UIKit

```swift
let planController = presenter.getViewController()
yourViewController.pushViewController(planController, animated: true)
```

### Present in SwiftUI

```swift
var body: some View {
	presenter.getView()
}
```

## Preparation for later use<a id='5.0.0-later-use'></a>

### Download a plan<a id='5.0.0-download'></a>

Use `ExpoFpPlan.downloader` property to manage downloads. Plan will be downloaded into cache directory in user domain mask.

You can download a plan from the internet:

```swift
let expoKey = "YourExpoKey"
let downloadedPlanResult = await ExpoFpPlan.downloader.downloadPlan(withExpoKey: expoKey) // Also awailable with completion
let downloadedPlanInfo = try downloadedPlanResult.get()
```

or unzip from the archive stored in the app:

```swift
let zipFilePath = Bundle.main.path(forResource: "<expokey>_<version>", ofType: "zip")
let downloadedPlanResult = await ExpoFpPlan.downloader.downloadPlan(withZipFilePath: zipFilePath) // Also awailable with completion
let downloadedPlanInfo = try downloadedPlanResult.get()
```

> Archive must be named `<expokey>_<version>.zip` to identify the plan.

### Use downloaded plan

You can store `downloadedPlanInfo` to use it later or get all info about downloaded plans by:

```swift
let downloadedPlansInfo = await ExpoFpPlan.downloader.getDownloadedPlansInfo() // Also awailable with completion
```

To create `presenter` from downloaded plan simply use `downloadedPlanInfo`:

```swift
let presenter = ExpoFpPlan.createPlanPresenter(with: .downloadedPlanInfo(downloadedPlanInfo))
```

### Clean old versions of downloaded plans

When you download a new version of a plan, you are responsible for deleting previous versions from the app.

```swift
await ExpoFpPlan.downloader.removeOldVersionsOfDownloadedPlans()
```

or by specific expo key

```swift
let expoKey = "YourExpoKey"
await ExpoFpPlan.downloader.removeOldVersionsOfDownloadedPlans(withExpoKey: expoKey)
```

### Delete downloaded plans

```swift
ExpoFpPlan.downloader.removeDownloadedPlan(with: downloadedPlanInfo)
or
ExpoFpPlan.downloader.removeAllDownloadedPlans()
```
---
### Preload a plan<a id='5.0.0-preload'></a>

> All preloaded plans retain their state during app lifecycle and release after app is terminated

Use `ExpoFpPlan.preloader` property to manage preloads.

You can preload a plan from the internet:

```swift
let expoKey = "YourExpoKey"
let preloadedPlanInfo = ExpoFpPlan.preloader.preloadPlan(with: .expoKey(expoKey))
```

Or preload from downloaded plan:

```swift
let preloadedPlanInfo = ExpoFpPlan.preloader.preloadPlan(with: .downloadedPlanInfo(downloadedPlanInfo))
```

### Use preloaded plan

You can store `preloadedPlanInfo` to use it later or get all info about preloaded plans by:

```swift
let preloadedPlansInfo = ExpoFpPlan.preloader.getPreloadedPlansInfo()
```

To get preloaded `presenter` simply use `preloadedPlanInfo `:

```swift
let presenter = ExpoFpPlan.preloader.getPreloadedPlanPresenter(with: preloadedPlanInfo)
```

If you have only one preloaded plan you can get `presenter` by:

```swift
let presenter = ExpoFpPlan.preloader.getPreloadedPlanPresenter()
```

### Delete preloaded plans

```swift
ExpoFpPlan.preloader.disposePreloadedPlan(with: preloadedPlanInfo)
or
ExpoFpPlan.preloader.removeAllPreloadedPlans()
```

## Management<a id='5.0.0-management'></a>

To manage a plan you need to get a `presenter` using one of the options above.

### Plan information<a id='5.0.0-info'></a>

`presenter.additionalParams` – Additional parameters applied to the plan<br>
`presenter.planLink` – Link from which the plan was loaded<br>
`presenter.locationProvider` – Location provider used by the plan<br>
`presenter.planStatusPublisher` – Monitoring plan status during loading and initialization<br>

### Settings<a id='5.0.0-settings'></a>

> All settings specified during `presenter` initialization can be changed or updated by following methods

Add or change additional plan parameters:

```swift
presenter.additionalParams // [URLQueryItem(name: "noOverlay", value: "true")]

let newParams = [URLQueryItem(name: "noOverlay", value: "false")]
presenter.applyNewAdditionalParams(newParams)

presenter.additionalParams // [URLQueryItem(name: "noOverlay", value: "false")]
```

Remove additional plan parameters:

```swift
presenter.removeAdditionalParams(forKeys: ["noOverlay"])
```

Add, change or remove location provider:

```swift
let locationProvider = YourLocationProvider()
presenter.setLocationProvider(locationProvider)

or

presenter.removeLocationProvider()
```

Add, change or remove event listener:

```swift
let messageListener = YpurPlanMessageListener()
presenter.setMessageListener(messageListener)

or

presenter.removeMessageListener()
```

### Commands<a id='5.0.0-commands'></a>

All commands are available with async/await and with completion.

Clear cache and reload a plan with specified or, if `nil` – previously setted parameters and location settings<br>

```swift
presenter.reloadPlan(
	planLink: YourLink or nil,
	additionalParams: YourParams or nil,
	locationProvider: YourProvider or nil,
	messageListener: YourListener or nil
)
```

Search location if location is enabled<br>
`presenter.findLocation()`

Display of a plan within its boundaries<br>
`presenter.fitBounds()`

Highlight the specified Booths<br>
`presenter.highlightBooths(externalIds: [String])`

Highlight the specified Exhibitors<br>
`presenter.highlightExhibitors(externalIds: [String])`

Select the specified Booth<br>
`presenter.selectBooth(nameOrExternalId: String)`

Select the specified Category<br>
`presenter.selectCategory(name: String?)`

Select the specified position and focus on it (Blue-dot)<br>
`presenter.selectCurrentPosition(_ position: ExpoFpPosition?, focus: Bool)`

Select the specified exibitors<br>
`presenter.selectExhibitor(nameOrExternalId: String)`

Build the specified route optionally for people with disabilities<br>
`presenter.selectRoute(waypoints: [ExpoFpRouteWaypoint], onlyAccessible: Bool)`

Add or remove bookmarks<br>
`presenter.setBookmarks(_ bookmarks: [ExpoFpBookmark])`

Enable or disable elements visibility in a plan<br>
`presenter.setElementsVisibility(_ elementsVisibility: ExpoFpElementsVisibility)`

Switch between 2D and 3D<br>
`presenter.switchView()`

Select plan layer<br>
`presenter.updateLayerVisibility(layer: String, isVisible: Bool)`

Zoom in<br>
`presenter.zoomIn()`

Zoom out<br>
`presenter.zoomOut()`

### Requests<a id='5.0.0-requests'></a>

Request plan booths<br>
`presenter.boothsList()`<br>
Return value: `ExpoFpResult<[ExpoFpBooth]>`

Request plan categories<br>
`presenter.categoriesList()`<br>
Return value: `ExpoFpResult<[ExpoFpCategory]>`

Request plan exhibitors<br>
`presenter.exhibitorsList()`<br>
Return value: `ExpoFpResult<[ExpoFpExhibitor]>`

Request information about elements visibility in a plan<br>
`presenter.getElementsVisibility()`<br>
Return value: `ExpoFpResult<ExpoFpElementsVisibility>`

Optimize the constructed route<br>
`presenter.getOptimizedRoutes(waypoints: [ExpoFpRouteWaypoint])`<br>
Return value: `ExpoFpResult<[ExpoFpRouteInfo]>`

Use fuzzy search through `Booths`, `Categories`, `Exhibitors` and `Schedule`<br>
`presenter.search(text: String)`<br>
Return value: `ExpoFpResult<[ExpoFpSearchModel]>`

## Events<a id='5.0.0-events'></a>

You need to create your own class and confirm it to `IExpoFpPlanMessageListener`

```swift
final class YourListener: IExpoFpPlanMessageListener {
...
}
```
Then set your listener during `presenter` initialization

```swift
let messageListener = YourListener()
let presenter = ExpoFpPlan.createPlanPresenter(
    with: .expoKey(expoKey),
    messageListener: messageListener
)
```
Or set to `presenter` after initialization

```swift
let messageListener = YourListener()
presenter.setMessageListener(messageListener)
```

### Listener events

Bookmark button has been pressed<br>
`func bookmarkDidClick(_ bookmark: ExpoFpResult<ExpoFpBookmark>, from planLink: ExpoFpLinkType)`

Booth has been pressed<br>
`func boothDidClick(_ boothEvent: ExpoFpResult<ExpoFpBoothClickEvent>, from planLink: ExpoFpLinkType)`

Category has been selected<br>
`func categoryDidClick(_ category: ExpoFpResult<ExpoFpCategory>, from planLink: ExpoFpLinkType)`

Current Position has been changed<br>
`func currentPositionDidChange(_ position: ExpoFpResult<ExpoFpPosition>, from planLink: ExpoFpLinkType)`

Details has been selected or deselected<br>
` func detailsDidClick(_ details: ExpoFpResult<ExpoFpDetails?>, from planLink: ExpoFpLinkType)`

Direction has been built or reset<br>
`func directionDidBuild(_ direction: ExpoFpResult<ExpoFpDirection?>, from planLink: ExpoFpLinkType)`

Custom Button has been pressed<br>
`func exhibitorCustomButtonDidClick(_ buttonEvent: ExpoFpResult<ExpoFpCustomButtonEvent>, from planLink: ExpoFpLinkType)`

Visited button has been pressed<br>
`func visitedDidClick(_ visitedEvent: ExpoFpResult<ExpoFpVisitedClickEvent>, from planLink: ExpoFpLinkType)`

## Navigation<a id='5.0.0-navigation'></a>

### Location provider management<a id='5.0.0-navigation-management'></a>

To automatically work with `presenter` location provider must confirm to `IExpoFpLocationProvider`.

#### Start

```swift
let locationProvider: IExpoFpLocationProvider = YourLocationProvider()
locationProvider.startUpdatingLocation()
```
or if global location provider is set

```swift
ExpoFpPlan.globalLocationProvider.startUpdatingLocation()
```

#### Stop
```swift
let locationProvider: IExpoFpLocationProvider = YourLocationProvider()
locationProvider.stopUpdatingLocation()
```

or if global location provider is set

```swift
ExpoFpPlan.globalLocationProvider.stopUpdatingLocation()
```

#### Listen location updates
You need to create your own class and confirm it to `ExpoFpLocationProviderDelegate`

```swift
let locationProvider: IExpoFpLocationProvider = YourLocationProvider()
let delegate: ExpoFpLocationProviderDelegate = YourExpoFpLocationProviderDelegate()

locationProvider.expoFpLocationProviderDelegate = delegate
```

or if global location provider is set

```swift
ExpoFpPlan.globalLocationProvider.expoFpLocationProviderDelegate = delegate
```

> **Important:** When you initialize `IExpoFpPlanPresenter` with location provider, it automatically becomes location provider delegate. If you need to listen location updates, don't set it to presenter, instead you can update location manually using `presenter.selectCurrentPosition(position)`

 
### Global location provider<a id='5.0.0-navigation-global'></a>

```swift
let locationProvider: IExpoFpLocationProvider = YourLocationProvider()
ExpoFpPlan.globalLocationProvider.sharedProvider = locationProvider

locationProvider.startUpdatingLocation() // if needed

let presenter = ExpoFpPlan.createPlanPresenter(
    with: .expoKey("YourExpoKey"),
    locationProvider: ExpoFpPlan.globalLocationProvider
)
```
Plan will call `startUpdatingLocation()` when it appers.<br>
**Important:** Plan will not call `stopUpdatingLocation()` when it disappears. You are responsible to stop global location provider when you need.

## Third-party location providers<a id='5.0.0-third-party-navigation'></a>

> Before using third-party coordinate providers(CrowdConnected or IndoorAtlas), the 'GPS/IPS from 3rd party' option must be activated:

![image](https://github.com/user-attachments/assets/65658895-cd91-4a66-936d-c7e9bf8ffd82)

## CrowdConnected location provider<a id='5.0.0-cc-navigation'></a>

Permissions in `Info.plist` file:

```xml
<key>UIBackgroundModes</key>
<array>
	<string>location</string>
</array>

<key>NSLocationAlwaysUsageDescription</key>
<string>Platform location requested for better indoor positioning experience.</string>

<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>Platform location requested for better indoor positioning experience.</string>

<key>NSLocationWhenInUseUsageDescription</key>
<string>Platform location requested for better indoor positioning experience.</string>
```

#### SPM

```swift
dependencies: [
    .package(url: "https://github.com/expofp/expofp-crowdconnected-ios", from: "5.0.0"),
]
```

and then as a dependency for the Package target utilizing **ExpoFpCrowdConnected**:

```swift
.target(
    name: "MyApp",
    dependencies: [
        .product(name: "ExpoFpCrowdConnected", package: "expofp-crowdconnected-ios"),
    ]
),
```

#### CocoaPods

```swift
spec.dependency 'ExpoFpCrowdConnected', '~>5.0.0'
```

### Initialization

```swift
let settings = ExpoFpCrowdConnectedLocationProviderSettings(
    appKey: "YourAppKey",
    token: "YourToken",
    secret: "YourSecret",
    navigationType: ExpoFpCrowdConnectedNavigationType = .ips, // or .geo or .all
    isAllowInBackground: false, // or true if NSLocationAlwaysUsageDescription added
    isHeadingEnabled: false, // or true if settings allowed
    aliases: ["AliasKey": "AliasValue"]
)

let locationProvider = ExpoFpCrowdConnectedLocationProvider(settings: settings)

let presenter = ExpoFpPlan.createPlanPresenter(
    with: .expoKey("YourExpoKey"),
    locationProvider: locationProvider
)
```

> Plan will call `startUpdatingLocation()` when it appers.<br>
> Plan will call `stopUpdatingLocation()` when it disappears if locationProvider is not set as Global.

## IndoorAtlas location provider<a id='5.0.0-ia-navigation'></a>

Permissions in `Info.plist` file:

```xml
<key>UIBackgroundModes</key>
<array>
    <string>location</string>
</array>

<key>NSLocationAlwaysUsageDescription</key>
<string>Platform location requested for better indoor positioning experience.</string>

<key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
<string>Platform location requested for better indoor positioning experience.</string>

<key>NSLocationWhenInUseUsageDescription</key>
<string>Platform location requested for better indoor positioning experience.</string>

<key>NSBluetoothAlwaysUsageDescription</key>
<string>Bluetooth requested for better positioning experience.</string>

<key>NSBluetoothPeripheralUsageDescription</key>
<string>Bluetooth requested for better positioning experience.</string>
```

#### SPM

```swift
dependencies: [
    .package(url: "https://github.com/expofp/expofp-indooratlas-ios", from: "5.0.0"),
]
```

and then as a dependency for the Package target utilizing **ExpoFpIndoorAtlas**:

```swift
.target(
    name: "MyApp",
    dependencies: [
        .product(name: "ExpoFpIndoorAtlas", package: "expofp-indooratlas-ios"),
    ]
),
```

#### CocoaPods

```swift
spec.dependency 'ExpoFpIndoorAtlas', '~>5.0.0'
```

### Initialization

```swift
let locationProvider = ExpoFpIndoorAtlasLocationProvider(
    apiKey: "YourAPIKey",
    apiSecretKey: "YourSecretKey"
)

let presenter = ExpoFpPlan.createPlanPresenter(
    with: .expoKey("YourExpoKey"),
    locationProvider: locationProvider
)
```

> Plan will call `startUpdatingLocation()` when it appers.<br>
> Plan will call `stopUpdatingLocation()` when it disappears if locationProvider is not set as Global.